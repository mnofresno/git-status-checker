#!/bin/bash

# Function to check the git status
check_git_status() {
    local dir="$1"
    cd "$dir" || return
    git_status=$(git status --porcelain 2>/dev/null)
    if [[ -z "$git_status" ]]; then
        echo "Clean"
    else
        if echo "$git_status" | grep -q "^ M"; then
            echo "Dirty"
        else
            echo "Stagging"
        fi
    fi
}

# Function to print the table header
print_header() {
    echo "+----------------------------+----------------+"
    echo "| Repository                 | Status         |"
    echo "+----------------------------+----------------+"
}

# Function to print a table row
print_row() {
    printf "| %-26s | %-14s |\n" "$1" "$2"
}

# Function to print the table footer
print_footer() {
    echo "+----------------------------+----------------+"
}

# Main function to find git repos and their statuses
main() {
    local target_dir="$1"

    if [[ -z "$target_dir" ]]; then
        echo "Usage: $0 <directory>"
        exit 1
    fi

    if [[ ! -d "$target_dir" ]]; then
        echo "Error: Directory '$target_dir' does not exist."
        exit 1
    fi

    cd "$target_dir" || exit

    print_header
    for dir in */ ; do
        if [ -d "$dir/.git" ]; then
            status=$(check_git_status "$dir")
            print_row "${dir%/}" "$status"
        fi
    done
    print_footer
}

# Run the main function with the specified directory
main "$1"

