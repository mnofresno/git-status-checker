#!/usr/bin/env bash

if [ $EUID -ne 0 ]; then
    echo "You must be root: \"sudo ngxdissite\""
    exit 1
fi

# Función para autocompletado
generate_autocomplete() {
    cat <<EOF >/etc/bash_completion.d/ngxdissite
_ngdis_autocomplete() {
    local cur=\${COMP_WORDS[COMP_CWORD]}
    COMPREPLY=(\$(compgen -W "\$(ls /etc/nginx/sites-enabled)" -- \${cur}))
    return 0
}
complete -F _ngdis_autocomplete ngxdissite
EOF
    echo "Autocomplete script for ngxdissite has been generated and installed."
    source /etc/bash_completion.d/ngxdissite
    exit 0
}

# Verificar si se pasa la opción --autocomplete
if [ "$1" == "--autocomplete" ]; then
    generate_autocomplete
fi

# Resto del script
if [ -z "$1" ]; then
    echo "Please choose a site."
    exit 1
else
    echo "Disabling site $1..."
    if [ ! -h "/etc/nginx/sites-enabled/$1" ] && [ ! -f "/etc/nginx/sites-enabled/$1" ]; then
        echo "$1 is not enabled."
        exit 1
    else
        rm "/etc/nginx/sites-enabled/$1"
        echo "Disabled $1"
        exit 0
    fi
fi
